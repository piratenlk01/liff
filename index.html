<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
    <title>My LIFF app</title>
    <!-- <link rel="stylesheet" href="css/style.css" media="all"> -->
    <script>
        document.write('<link rel="stylesheet" href="css/style.css?cache=' + new Date().getTime() + '">')
    </script>
</head>

<body>
    <!-- getEnvironment -->
    <p id="os"><b>OS:</b> </p>
    <p id="language"><b>Language:</b> </p>
    <p id="version"><b>Version:</b> </p>
    <p id="isInClient"><b>isInClient:</b> </p>
    <p id="accessToken"><b>AccessToken:</b> </p>

    <!-- getProfile -->
    <img id="pictureUrl">
    <p id="userId"><b>userId:</b> </p>
    <p id="displayName"><b>displayName:</b> </p>
    <p id="statusMessage"><b>statusMessage:</b> </p>

    <!-- getEmail -->
    <p id="decodedIDToken"><b>email:</b> </p>

    <!-- getContext -->
    <p id="type"><b>type:</b> </p>
    <p id="viewType"><b>viewType:</b> </p>
    <p id="utouId"><b>utouId:</b> </p>
    <p id="roomId"><b>roomId:</b> </p>
    <p id="groupId"><b>groupId:</b> </p>

    <!-- getFriendship -->
    <p id="friendship"><b>isFriendship:</b> </p>

    <p id="scanCode"><b>Code:</b> </p>
    <p id="isLoggedIn"><b>isLoggedIn:</b> </p>
    <p id="universalLink1"><b>Universal Link:</b> </p>
    <p id="universalLink2"><b>Universal Link with Query params:</b> </p>
    <p><a href="https://piratenlk01.github.io/liff/path/?param=9">Link to Path</a></p>

    <button id="btnMsg" onclick="sendMsg()">Send Message</button>
    <button id="btnMsg" onclick="sendMsg2()">Send Message 2</button>
    <button id="btnShare" onclick="shareMsg()">Share Target Picker</button>
    <button onclick="openWindow()">Open Window</button>
    <button id="btnScanCode" onclick="scanCode()">Scan Code</button>
    <button id="btnLogOut" onclick="logOut()">Log Out</button>
    <button id="btnClose" onclick="closedd()">Close</button>

    <script src="js/vconsole.min.js"></script>
    <script>
        var vConsole = new VConsole()
        console.log("Hello World!")
    </script>

    <script src="https://static.line-scdn.net/liff/edge/versions/2.9.0/sdk.js"></script>
    <script>
        function createUniversalLink() {
            const link1 = liff.permanentLink.createUrl()
            document.getElementById("universalLink1").append(link1)

            liff.permanentLink.setExtraQueryParam('param=9')
            const link2 = liff.permanentLink.createUrl()
            document.getElementById("universalLink2").append(link2)
        }


        async function shareMsg() {     // ใช้ได้กับ line version 10.3.0 เป็นต้นไป
            await liff.shareTargetPicker([
                {
                    "type": "text",
                    "text": "this message was sent by ShareTargetPicker"
                }
            ])
        }

        function logOut() {
            liff.logout()
            window.location.reload()
        }

        function closedd() {
            liff.closeWindow()
        }

        async function scanCode() {
            const result = await liff.scanCode()
            document.getElementById("scanCode").append(result.value)
        }

        // เปิด เว็บ ที่ external browser
        function openWindow() {
            liff.openWindow({
                url: "https://line.me",
                external: true
            })
        }

        async function getFriendship() {
            const friend = await liff.getFriendship()
            document.getElementById('friendship').append(friend.friendFlag)
            // if(!friend.friendFlag){
            //     if(confirm("คุณยังไม่ได้เพิ่ม Bot เป็นเพื่อน จะเพิ่มเลยไหม?")) {
            //         window.location = "..."
            //     }
            // }
        }

        async function sendMsg() {
            if (liff.getContext().type !== "none") {
                await liff.sendMessages([
                    {
                        "type":"text",
                        "text":"สวัสดี"
                    }
                ]),
                    alert("Message sent!")
            }
        }

        async function sendMsg2() {
            if (liff.getContext().type !== "none") {
                await liff.sendMessages([
                    {
                        "type":"flex",
                        "altText":"This is a Flex message",
                        "contents":
                        {
                            "type": "bubble",
                            "body": {
                                "type": "box",
                                "layout": "vertical",
                                "spacing": "md",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "Ngow Hock Book Ticket ",
                                        "weight": "bold",
                                        "size": "xl",
                                        "gravity": "center",
                                        "wrap": true,
                                        "contents": []
                                    },
                                    {
                                        "type": "box",
                                        "layout": "vertical",
                                        "spacing": "sm",
                                        "margin": "lg",
                                        "contents": [
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "spacing": "sm",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "Location",
                                                        "size": "sm",
                                                        "color": "#AAAAAA",
                                                        "flex": 2,
                                                        "contents": []
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "Bkk",
                                                        "size": "sm",
                                                        "color": "#666666",
                                                        "flex": 4,
                                                        "wrap": true,
                                                        "contents": []
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "spacing": "sm",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "รับบริการ",
                                                        "size": "sm",
                                                        "color": "#AAAAAA",
                                                        "flex": 2,
                                                        "contents": []
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "ขาเข้า - ขาออก",
                                                        "size": "sm",
                                                        "color": "#666666",
                                                        "flex": 4,
                                                        "wrap": true,
                                                        "contents": []
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "spacing": "sm",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "ผู้ติดต่อ",
                                                        "size": "sm",
                                                        "color": "#AAAAAA",
                                                        "flex": 2,
                                                        "contents": []
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "บริษัท เหินฟ้า ไทยแลน จำกัด ",
                                                        "size": "sm",
                                                        "color": "#666666",
                                                        "flex": 4,
                                                        "wrap": true,
                                                        "contents": []
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "margin": "xl",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "Ref No. ",
                                                        "weight": "bold",
                                                        "size": "lg",
                                                        "color": "#594D95FF",
                                                        "flex": 2,
                                                        "contents": []
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "AAA00001",
                                                        "weight": "bold",
                                                        "size": "xl",
                                                        "color": "#594D95FF",
                                                        "flex": 4,
                                                        "contents": []
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "vertical",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "นัดหมาย",
                                                        "weight": "bold",
                                                        "size": "xl",
                                                        "color": "#5F00FFFF",
                                                        "align": "start",
                                                        "decoration": "underline",
                                                        "contents": []
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "วันที่",
                                                        "weight": "bold",
                                                        "color": "#200080FF",
                                                        "flex": 2,
                                                        "contents": []
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "15 สิงหาคม 2562 ",
                                                        "weight": "bold",
                                                        "color": "#200080FF",
                                                        "flex": 4,
                                                        "contents": []
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "เวลา",
                                                        "weight": "bold",
                                                        "color": "#200080FF",
                                                        "flex": 2,
                                                        "contents": []
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "14.30น.",
                                                        "weight": "bold",
                                                        "color": "#200080FF",
                                                        "flex": 4,
                                                        "contents": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "type": "box",
                                        "layout": "vertical",
                                        "margin": "xxl",
                                        "contents": [
                                            {
                                                "type": "spacer",
                                                "size": "xs"
                                            },
                                            {
                                                "type": "image",
                                                "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/linecorp_code_withborder.png",
                                                "size": "xl",
                                                "aspectMode": "cover"
                                            },
                                            {
                                                "type": "text",
                                                "text": "ขอสงวดสิทธิ์การนัดหมายของผู้เข้ารับบริการ ถ้าเลยเวลานัดหมาย 30 นาที",
                                                "size": "xs",
                                                "color": "#FF0000FF",
                                                "margin": "xxl",
                                                "wrap": true,
                                                "contents": []
                                            }
                                        ]
                                    }
                                ]
                            }
                        }
                    }
                ]),
                    alert("Message sent!")
            }
        }

        function getContext() {
            document.getElementById("type").append(liff.getContext().type)      // ดูว่า liff มาจากห้องแชทแบบไหน  1on1,group,room
            document.getElementById("viewType").append(liff.getContext().viewType)  // ดูว่า liff เป็น view แบบไหน Full,Tall,Compact
            document.getElementById("utouId").append(liff.getContext().utouId)    // จะแสดง id ของห้องแชทแบบ 1on1
            document.getElementById("roomId").append(liff.getContext().roomId)    // จะแสดง id ของห้องแชทแบบ room
            document.getElementById("groupId").append(liff.getContext().groupId)    // จะแสดง id ของห้องแชทแบบ group
        }


        async function getUserProfile() {
            const profile = await liff.getProfile()
            document.getElementById("pictureUrl").src = profile.pictureUrl
            document.getElementById("userId").append(profile.userId)
            document.getElementById("statusMessage").append(profile.statusMessage)
            document.getElementById("displayName").append(profile.displayName)

            document.getElementById("decodedIDToken").append(liff.getDecodedIDToken().email)
        }

        function getEnvironment() {
            document.getElementById("os").append(liff.getOS())                      // ดูว่าเปิด liff ใน os หรือ ad หรือ web 
            document.getElementById("language").append(liff.getLanguage())          // ให้ทราบภาษาของผู้ใช้
            document.getElementById("version").append(liff.getVersion())            // ดู version ของ liff
            document.getElementById("accessToken").append(liff.getAccessToken())    // ดู token 
            document.getElementById("isInClient").append(liff.isInClient())         // ดูว่าเปิด liff ใน lineapp หรือ external browser

            //  เปิด liff ใน lineapp หรือไม่ 
            if (liff.isInClient()) {                                        // ใช่
                document.getElementById("btnLogOut").style.display = "none"         // ซ่อนปุ่ม LogOut
            } else {                                                        // ไม่ใช่
                document.getElementById("btnMsg").style.display = "none"            // ซ่อนปุ่ม sent Message
                document.getElementById("btnScanCode").style.display = "none"       // ซ่อน scan qr code
                document.getElementById("btnClose").style.display = "none"          // ซ่อนปุ่ม Close
            }
        }



        async function main() {
            liff.ready.then(() => {
                document.getElementById("isLoggedIn").append(liff.isLoggedIn())     // เช็คว่า user login line หรือไม่
                if (liff.isLoggedIn()) {
                    getEnvironment()
                    getUserProfile()    // เรียกใช้ fucntion GetUserProfile
                    getContext()
                    getFriendship()     // กรณีที่ liff ต้องทำงานกับ chatbot ต้องเช็คก่อนว่า user เป็นเพื่อนกับ chatbot หรือไม่โดยใช้ function getFriendship
                    createUniversalLink()
                } else {
                    liff.login()
                }
            })
            await liff.init({ liffId: "1655891601-ZKgzKVDz" })

        }
        main()
    </script>
</body>

</html>